{% extends 'base.html' %}
{% load static %}

{% block title %}
  Пошук нерухомості — DOMINIUM
{% endblock %}

{% block main_padding %}pt-[80px]{% endblock %}

{% block head %}
  {{ block.super }}
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
{% endblock %}

{% block content %}
  {% include 'partials/base-filters.html' %}
  {% include 'partials/property_sort_bar.html' %}

  <section class="w-full max-w-[1200px] mx-auto px-4 sm:px-6 lg:px-8 mt-6">
    <div class="flex flex-wrap items-center justify-between gap-3">
      <div class="flex items-center gap-2">
        <button
          type="button"
          class="view-toggle-btn active px-4 py-2 rounded-full text-sm font-fixel bg-deepOcean text-white shadow transition"
          data-view="list"
        >
          <i class="ri-layout-grid-line mr-1"></i>
          Список
        </button>
        <button
          type="button"
          class="view-toggle-btn px-4 py-2 rounded-full text-sm font-fixel bg-white text-deepOcean shadow border border-deepOcean/20 hover:bg-deepOcean hover:text-white transition"
          data-view="map"
          {% if not has_coordinates %}disabled{% endif %}
        >
          <i class="ri-map-pin-line mr-1"></i>
          Карта
        </button>
        <button
          type="button"
          class="view-toggle-btn px-4 py-2 rounded-full text-sm font-fixel bg-white text-deepOcean shadow border border-deepOcean/20 hover:bg-deepOcean hover:text-white transition hidden"
          data-view="heatmap"
        >
          <i class="ri-fire-line mr-1"></i>
          Heatmap
        </button>
      </div>
      {% if not has_coordinates %}
        <p class="text-xs text-gray-500 font-fixel">
          Для частини об’єктів відсутні координати. Поки що карта може бути недоступною.
        </p>
      {% endif %}
    </div>
  </section>

  <section class="w-full max-w-[1200px] mx-auto px-4 sm:px-6 lg:px-8 py-6 view-panel" data-panel="list">
    {% include 'partials/property_list.html' %}
    {% include 'partials/property_cards.html' %}
  </section>

  <section class="view-panel hidden w-full max-w-[1200px] mx-auto px-4 sm:px-6 lg:px-8 pb-10" data-panel="map">
    <div class="bg-white border border-gray-200 rounded-[16px] overflow-hidden shadow-md">
      <div id="properties-map" class="h-[500px] sm:h-[620px] w-full"></div>
    </div>
    <div id="map-empty-state" class="mt-4 text-sm text-gray-600 font-fixel {% if has_coordinates %}hidden{% endif %}">
      На жаль, зараз немає об’єктів із координатами для відображення на карті.
    </div>
  </section>

  <div id="advanced-filters-modal" class="modal hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70">
    <div class="modal-content bg-white w-full sm:w-[80%] md:max-w-4xl sm:rounded-2xl p-4 sm:p-6 shadow-xl ring-1 ring-black/10 relative max-h-[90vh] overflow-y-auto sm:animate-fade-in animate-slide-up-mobile">
      <button
        id="close-filters-btn"
        class="absolute top-4 right-4 w-8 h-8 rounded-full flex items-center justify-center bg-gray-100 hover:bg-gray-200 transition"
      >
        <i class="ri-close-line text-gray-700 text-xl"></i>
      </button>
      {% include 'partials/advanced_filters.html' %}
    </div>
  </div>
{% endblock %}

{% block scripts %}
  {{ block.super }}
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
  <script>
    window.PROPERTY_GEOJSON = {{ properties_geojson|safe }};
    window.HAS_COORDINATES = {{ has_coordinates|yesno:"true,false" }};
  </script>
  <script src="{% static 'base/assets/js/search_filters.js' %}"></script>
  <script src="{% static 'base/assets/js/map-view.js' %}"></script>
{% endblock %}
