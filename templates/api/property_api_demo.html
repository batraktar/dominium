{% extends 'base.html' %}
{% load static %}

{% block title %}
  API Demo — DOMINIUM
{% endblock %}

{% block main_padding %}pt-[80px]{% endblock %}

{% block content %}
  <section class="container mx-auto px-4 py-10 text-white">
    <h1 class="text-3xl font-ermilov mb-4">Перевірка API нерухомості</h1>
    <p class="text-coolSage font-fixel mb-6">
      Ця сторінка показує, як отримати дані з <code class="bg-black/20 px-1 rounded">/api/properties/</code>.
    </p>

    <div class="bg-white rounded-[9px] p-6 text-deepOcean shadow-lg mb-6">
      <h2 class="text-xl font-semibold mb-2">Результати</h2>
      <p class="text-sm text-gray-500 mb-4">
        Сторінка робить запит одразу після завантаження. Натисніть кнопку, щоб оновити дані.
      </p>
      <button
        id="reload-properties"
        class="inline-flex items-center gap-2 px-4 py-2 bg-deepOcean text-white rounded-[9px] font-fixel hover:bg-deepOcean/90 transition"
      >
        <i class="ri-refresh-line"></i>
        Оновити список
      </button>
      <pre id="properties-output" class="bg-gray-900 text-gray-100 rounded-[9px] mt-4 p-4 overflow-x-auto text-sm">Завантаження...</pre>
    </div>

    <div class="bg-white rounded-[9px] p-6 text-deepOcean shadow-lg">
      <h2 class="text-xl font-semibold mb-2">Доступні ендпоїнти</h2>
      <ul class="list-disc pl-6 space-y-1 text-sm text-gray-700">
        <li><code>/api/properties/</code> — список об'єктів (GET), створення (POST)</li>
        <li><code>/api/properties/&lt;id&gt;/</code> — перегляд, редагування, видалення</li>
        <li><code>/api/property-types/</code> — довідник типів нерухомості</li>
        <li><code>/api/deal-types/</code> — довідник типів угод</li>
        <li><code>/api/features/</code> — доступні характеристики</li>
      </ul>
    </div>
  </section>
{% endblock %}

{% block scripts %}
  {{ block.super }}
  <script>
    const outputNode = document.getElementById("properties-output");
    const reloadBtn = document.getElementById("reload-properties");

    async function loadProperties() {
      outputNode.textContent = "Завантаження...";

      try {
        const response = await fetch("{% url 'house_api:property_list' %}");
        if (!response.ok) {
          throw new Error(`Статус ${response.status}`);
        }
        const data = await response.json();
        outputNode.textContent = JSON.stringify(data, null, 2);
      } catch (error) {
        outputNode.textContent = `Помилка: ${error.message}`;
      }
    }

    reloadBtn?.addEventListener("click", loadProperties);
    loadProperties();
  </script>
{% endblock %}
